
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mkvmerge | Remuxer une saison à la volée - Personal blog of Quentin Rousseau</title>
  <meta name="author" content="Quentin Rousseau">

  
  <meta name="description" content="IT Engineer Graduate @Telecombretagne (Brest, FR). Senior software engineer at @instacart (San Francisco, CA)." />

  
  <meta name="keywords" content="blog, quentin, rousseau, IT, engineer, developer, instacart" />

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.quent.in/index.php/2011/08/mkvmerge-remuxer-une-saison-a-la-volee">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Personal blog of Quentin Rousseau" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46809655-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<div class="container">
		<aside class="left">
			<div class="inner-left">
				<header>
					<a href="/"><img src="http://www.gravatar.com/avatar/40792355b0aa756614c0abd37e75c0d3?s=250" alt="Quentin Rousseau " title="Quentin Rousseau"/></a>
<hgroup>
  <div class="title"><a href="/">Quentin Rousseau</a></div>
  
  	
    <h2 class="subtitle">IT Engineer Graduate <a href="https://twitter.com/Telecombretagne" alt="@Telecombretagne">@Telecombretagne</a> (Brest, FR). Senior software engineer at <a href="https://twitter.com/instacart" alt="@instacart">@instacart</a> (San Francisco, CA).</h2>
   
</hgroup>


				</header>
				<footer>
					<p>
	
		<a href="http://github.com/kwent" class="btn btn-dark"><i class="fa fa-inverse fa-github fa-2x"></i></a>
	
	
		<a href="http://twitter.com/quentinrousseau" class="btn btn-dark"><i class="fa fa-inverse fa-twitter fa-2x"></i></a>
	
	
        <a href="https://www.linkedin.com/in/quentinrousseau" class="btn btn-dark"><i class="fa fa-inverse fa-linkedin fa-2x"></i></a>
    
	
        <script type="text/javascript"> document.write('<a style="unicode-bidi: bidi-override; direction: rtl;" class="btn btn-dark" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;contact&#64;quent&#46;in"><i class="fa fa-inverse fa-envelope fa-2x"></i></a>');</script>
    
</p>

				</footer>
			</div>
		</aside>
    	<section class="right">
    		<div class="inner-right">
    			<div id="posts">
    			  	<article class="post">
    <header>
  
	<h1 class="entry-title">Mkvmerge | Remuxer Une Saison à La Volée</h1>


<p class="meta">
  








  


<time datetime="2011-08-04T11:39:30-07:00" pubdate data-updated="true">Aug 4<span>th</span>, 2011</time>
   | <a href="#disqus_thread" data-disqus-identifier="http://blog.quent.in">Comments</a>
  
</p>
<p class="header_categories">
  
</p>

</header>

<div class="entry-content"><p>Heureux possesseur d&rsquo;un <strong>NAS</strong> <a href="http://www.synology.com/us/products/DS211j/index.php" target="_blank">Synology DS211j</a>, j&rsquo;ai parfois besoin de remuxer <strong>des saisons complètes de séries</strong> (pour intégrer des sous titres la plupart du temps), et tant qu&rsquo;à faire autant les remuxer <strong>en local</strong> sur le NAS.</p>

<p>Pour cela j&rsquo;utilise le binaire <strong>mkvmerge</strong> contenu dans le package <a href="http://www.bunkus.org/videotools/mkvtoolnix/" target="_blank"><strong>mkvtoolnix</strong></a>.</p>

<p><span style="color: #ff6600;"><strong>1ère étape:</strong></span> Récupérer le paquet mkvtoolnix et l&rsquo;installer.</p>

<p><strong>Note:</strong> Je ne récupère pas mkvtoolnix via le dépôt <a href="http://ipkg.nslu2-linux.org/feeds/optware/cs05q3armel/cross/unstable/" target="_blank"><a href="http://ipkg.nslu2-linux.org/feeds/optware/cs05q3armel/cross/unstable/">http://ipkg.nslu2-linux.org/feeds/optware/cs05q3armel/cross/unstable/</a></a> car celui-ci n&rsquo;a pas fonctionné pour moi (manque de dépendances). <strong>Voir <a href="http://forum.synology.com/enu/viewtopic.php?f=40&t=36845" target="_blank">ici</a></strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>wget mkvtoolnix http://www.rzuser.uni-heidelberg.de/~tkolb3/mkvtoolnix_4.2.0-1_arm.ipk
</span><span class='line'>ipkg install mkvtoolnix_4.2.0-1_arm.ipk
</span></code></pre></td></tr></table></div></figure>


<p>Vous vous retrouvez face à une jolie erreur de <strong>MD5</strong> (c&rsquo;est normal car ce n&rsquo;est pas le paquet issu du dépôt officiel)</p>

<p>Il faut alors modifier le MD5 dans <strong>/opt/lib/ipkg/lists/cross</strong> de mkvtoolnix par celui-ci <strong>0be20bd376391c911a7eeba46c8883ac </strong>et réitérer l&rsquo;opération.****</p>

<p><span style="color: #ff6600;"><strong>2ème étape:</strong></span> mkvtoolnix est maintenant opérationnel sur le Synology, passons au remuxage !</p>

<h3><span style="color: #333333;">Contexte:</span></h3>

<p>Soit <strong>une saison</strong> de<strong> 23 épisodes </strong>auxquelles je veux ajouter des <strong>fichiers de sous titres (.srt) Français et Anglais, la structure étant la suivante:<br/>
</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ls
</span><span class='line'>01 - REMUX  # Dossier de destination
</span><span class='line'>02 - FR_SRT # Contient les sous titres FR sous la forme Serie.SXXEXX.720p.HDTV.x264.srt
</span><span class='line'>03 - EN_SRT # Contient les sous titres EN sous la forme Serie.SXXEXX.720p.HDTV.x264.srt
</span><span class='line'>Serie.SXXE01.720p.HDTV.x264.mkv #Fichier à remuxer
</span><span class='line'>Serie.SXXE02.720p.HDTV.x264.mkv #Fichier à remuxer
</span><span class='line'>Serie.SXXE03.720p.HDTV.x264.mkv #Fichier à remuxer
</span><span class='line'>Serie.SXXE04.720p.HDTV.x264.mkv #Fichier à remuxer
</span><span class='line'>...
</span><span class='line'>Serie.SXXE23.720p.HDTV.x264.mkv #Fichier à remuxer</span></code></pre></td></tr></table></div></figure>


<p>On ajoute à cela un petit script reposant sur une <strong>boucle for</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> -e “Mkvmerge - Remux en série.”
</span><span class='line'><span class="nv">PATH_TO_MEDIA</span><span class="o">=</span><span class="nv">$3</span>
</span><span class='line'><span class="nv">FR_PATH</span><span class="o">=</span><span class="nv">$4</span>’/’
</span><span class='line'><span class="nv">EN_PATH</span><span class="o">=</span><span class="nv">$5</span>’/’
</span><span class='line'><span class="nv">OUTPUT_FOLDER</span><span class="o">=</span><span class="nv">$6</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> -e “Remux des episodes <span class="nv">$1</span> à l’épisode <span class="nv">$2</span>”
</span><span class='line'><span class="nb">echo</span> -e “Répértoire des médias à transcoder: <span class="nv">$3</span>”
</span><span class='line'><span class="nb">echo</span> -e “FR_PATH: <span class="nv">$4</span>”
</span><span class='line'><span class="nb">echo</span> -e “EN_PATH: <span class="nv">$5</span>”
</span><span class='line'><span class="nb">echo</span> -e “Notes: .srt files need to be in UTF-8 format”
</span><span class='line'><span class="nb">echo</span> -e “Répértoire de destination: <span class="nv">$6</span>”
</span><span class='line'><span class="nb">echo</span> -e
</span><span class='line'>
</span><span class='line'><span class="k">for </span>i in <span class="sb">`</span>seq <span class="nv">$1</span> <span class="nv">$2</span><span class="sb">`</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Prefix ‘0’ pour les épisodes &lt; 10</span>
</span><span class='line'><span class="k">if </span><span class="nb">test</span> <span class="nv">$i</span> -lt 10
</span><span class='line'><span class="k">then</span>
</span><span class='line'><span class="nv">namefile</span><span class="o">=</span>“Serie.SXXE0<span class="nv">$i</span>.720p.HDTV.x264”
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="nv">namefile</span><span class="o">=</span>“Serie.SXXE<span class="nv">$i</span>.720p.HDTV.x264”
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> -e “Media entrant: <span class="nv">$PATH_TO_MEDIA</span>/<span class="nv">$namefile</span>”
</span><span class='line'><span class="nb">echo</span> -e “Media sortant: <span class="nv">$OUTPUT_FOLDER</span>/<span class="nv">$namefile</span>”
</span><span class='line'><span class="nb">echo</span> -e “EN SRT: <span class="nv">$EN_PATH$namefile</span>.srt”
</span><span class='line'><span class="nb">echo</span> -e “FR SRT: <span class="nv">$FR_PATH$namefile</span>.srt”
</span><span class='line'>mkvmerge -v -o “<span class="nv">$OUTPUT_FOLDER</span>/<span class="nv">$namefile</span>.mkv” “–language” “1:eng” “–default-track” “1:no” “–forced-track” “1:no” “–display-dimensions” “1:1280x720” “–default-track” “2:yes” “–forced-track” “2:no” “-a” “2” “-d” “1” “-S” “-T” “–no-global-tags” “–no-chapters” “<span class="nv">$PATH_TO_MEDIA</span>/<span class="nv">$namefile</span>.mkv” “–language” “0:eng” “–track-name” “0:English” “–default-track” “0:no” “–forced-track” “0:no” “-s” “0” “-D” “-A” “-T” “–no-global-tags” “–no-chapters” “<span class="nv">$EN_PATH$namefile</span>.srt” “–language” “0:fre” “–track-name” “0:French” “–forced-track” “0:no” “-s” “0” “-D” “-A” “-T” “–no-global-tags” “–no-chapters” “<span class="nv">$FR_PATH$namefile</span>.srt” “–track-order” “0:1,0:2,2:0,1:0”
</span><span class='line'>
</span><span class='line'><span class="k">done</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>3ème étape:</strong> Il ne reste plus qu&rsquo;à appeler notre script de la façon suivante :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sh monscript 1 23 <span class="nv">$FOLDER_TO_MEDIA</span> <span class="nv">$FR_SUBTITLES_FOLDER</span> <span class="nv">$EN_SUBTITLES_FOLDER</span> <span class="nv">$DESTINATION_FOLDER</span>
</span><span class='line'>sh monscript 1 23 “/Series/MaSerie/Saison X” “/Series/MaSerie/Saison X/02 - FR_SRT” “/Series/MaSerie/Saison X/03 - EN_SRT” “/Series/MaSerie/Saison X/01 - REMUX”
</span></code></pre></td></tr></table></div></figure>


<p><span style="color: #ff0000;"><strong>Note</strong></span><span style="color: #ff0000;"><strong> 1</strong></span><span style="color: #ff0000;"><strong>:</strong></span> Dans l&rsquo;état actuel du script, la langue française sera la langue <strong>par défaut</strong>. Pour changer ce comportement, jouez avec le paramètre suivante: <strong>&laquo;&nbsp;&#8211;</strong>default-track&nbsp;&raquo; &laquo;&nbsp;2:yes&nbsp;&raquo;<strong> ou </strong>&laquo;&nbsp;<strong>&#8211;default-track&nbsp;&raquo; &laquo;&nbsp;0:no&nbsp;&raquo;</strong>****.</p>

<p><strong><span style="color: #ff0000;">Note 2:</span></strong> Dans l&rsquo;état actuel du script, les fichiers de sous titres (.srt) doivent être encodés au format <strong>UTF-8</strong>. Pour changer ce comportement, jouez avec le paramètre: <strong>&laquo;&nbsp;&#8211;chapter-charset character-set&nbsp;&raquo;</strong></p>

<p><span style="color: #ff0000;"><strong>Update:</strong> <span style="color: #000000;">Gist available with script update : <a href="https://gist.github.com/kwent/5382866"><a href="https://gist.github.com/kwent/5382866">https://gist.github.com/kwent/5382866</a></a></span></span></p>

<h2>More&hellip;</h2>

<ul>
<li><a href="http://www.bunkus.org/videotools/mkvtoolnix/" title="mkvtoolnix -- Matroska tools for Linux/Unix and Windows" rel="nofollow">mkvtoolnix &mdash; Matroska tools for Linux/Unix and Windows</a></li>
<li><a href="http://www.bunkus.org/videotools/mkvtoolnix/doc/mkvmerge.html" title="mkvmerge" rel="nofollow">mkvmerge</a></li>
<li><a href="http://www.synology.com/us/products/DS211j/index.php" title="Synology Network Attached Storage - Products :: DiskStation ..." rel="nofollow">Synology Network Attached Storage &ndash; Products :: DiskStation &hellip;</a></li>
</ul>

</div>


</article>


        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://blog.quent.in/index.php/2011/08/mkvmerge-remuxer-une-saison-a-la-volee/" data-via="quentinrousseau" data-counturl="http://blog.quent.in/index.php/2011/08/mkvmerge-remuxer-une-saison-a-la-volee/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>




<section id="comments">
    <div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>


    			</div>
    			

<script type="text/javascript">
      var disqus_shortname = 'quentinrousseauleblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.quent.in/index.php/2011/08/mkvmerge-remuxer-une-saison-a-la-volee/';
        var disqus_url = 'http://blog.quent.in/index.php/2011/08/mkvmerge-remuxer-une-saison-a-la-volee/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46809655-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




    		</div>
    	</section>
  	</div>
</body>
</html>
